# 论文笔记：Searching Central Difference Convolutional Networks for Face Anti-Spoofing（CDCN / CDCN++）

> 基于原文做的学习笔记与要点整理。 [oai_citation:0‡Yu 等 - 2020 - Searching Central Difference Convolutional Networks for Face Anti-Spoofing.pdf](sediment://file_000000005f6c61f592c146f685f94156)

---

## 1. 研究动机与问题设定

- **场景**：人脸识别系统易受展示攻击（打印照、屏幕重放、3D 面具等）影响，需要**人脸活体检测（FAS/PAD）**保障安全。
- **痛点**：
  1) 常规 CNN 偏向语义强的深层特征，**对细粒度伪造痕迹（如网格、摩尔纹、噪声）刻画不足**，且光照/相机变化下易退化；  
  2) 许多 SOTA 方法依赖**多帧时序**（rPPG、运动线索），**不利于实时部署**。
- **目标**：在**单帧**输入下，稳健地捕获**细粒度且跨域鲁棒**的伪造线索。

---

## 2. 核心贡献

1) 提出**中央差分卷积（Central Difference Convolution, CDC）**：将**强度**与**梯度（中心差分）**信息聚合，**不增加参数**、可无缝替换普通卷积。  
2) 基于 CDC 构建 **CDCN**；并在 CDC 搜索空间上用 **NAS** 搜索得到更强的骨干，叠加**多尺度注意融合模块（MAFM）**，形成 **CDCN++**。  
3) **单帧、深度监督**范式：以伪深度图为辅助监督，显著提升稳健性与泛化。  
4) 在 6 大数据集的**体内/跨库/跨类型**评测上取得领先或SOTA水平（如 OULU-NPU Prot-1 **ACER=0.2%**；CASIA→Replay **HTER=6.5%**）。

---

## 3. 方法一：中央差分卷积（CDC）

### 3.1 基本记号

- 普通 2D 卷积（核邻域 $R$）：  
  
  $$
  y(p_0)=\sum_{p_n\in R} w(p_n)\cdot x(p_0+p_n).
  $$
- **中心差分**思想：将每个邻域采样与中心值做差，显式引入**梯度/细节**。

### 3.2 CDC 的一般形式

将强度与梯度加权融合（超参 $\theta\in[0,1]$）：

$\underbrace{y(p_0)}_{\text{CDC}}
=\theta\!\sum_{p_n\in R} w(p_n)\big[x(p_0+p_n)-x(p_0)\big]
+(1-\theta)\!\sum_{p_n\in R} w(p_n)x(p_0+p_n).
$

- **特例**：$\theta=0$ 退化为普通卷积；$\theta>0$ 增强细节敏感性与跨域鲁棒性。  
- 论文经验：$\theta\approx 0.7$ 效果最佳（OULU-NPU Prot-1）。

### 3.3 高效实现（与普通卷积等价改写）

将 CDC 写成“普通卷积 + 一项中心差分校正”：
$
y(p_0)=\sum_{p_n\in R} w(p_n)\,x(p_0+p_n)\;+\;\theta\cdot\Big(-x(p_0)\sum_{p_n\in R} w(p_n)\Big).
$

> 因而**无需新增参数或显著改代码**，可在 PyTorch/TensorFlow 中以少量算子组合实现。

### 3.4 与相关方法关系

- **Local Binary Convolution**：重在**降算量**，表达力有限；CDC 注重**细节表征**。  
- **Gabor Convolution**：重在**尺度/方向**不变性；CDC 更关注**微结构/纹理伪迹**。  
- **结论**：在 FAS 中，CDC 相比普通卷积、LBConv、GaborConv 均更优（ACER 更低）。

---

## 4. 方法二：CDCN 与 CDCN++（NAS + MAFM）

### 4.1 CDCN（单帧、深度监督）

- **输入**：单帧 RGB 人脸（$256\times256$）；输出 $32\times32$ **深度图**。  
- **损失**：  
  - 像素 MSE：$L_{\text{MSE}}$；  
  - **对比深度损失** $L_{\text{CDL}}$（强调局部梯度/细节）；  
  - 总损失：$L=L_{\text{MSE}}+L_{\text{CDL}}$。  
- **训练标签**：真脸深度归一化到 $[0,1]$；攻击样本深度置 $0$。  
- **结构**：低/中/高三层级特征（均用 CDC），多层级拼接后回归深度。

### 4.2 CDCN++：搜索到的 CDC 骨干 + MAFM

- **NAS 搜索空间**：以**Cell**为基本单元（DAG、6 个节点），候选算子为若干 CDC 变体/跳连/空。  
  - **Varied Cells**：低/中/高层**可用不同 Cell**（更贴合层级表征）。  
  - **Node Attention**：对中间节点引入权重 $\beta$ 的 softmax 选择输出。  
- **MAFM（多尺度空间注意）**：  
  - 对低/中/高层特征分别用**不同核尺寸**的空间注意（建议：$7{\times}7/5{\times}5/3{\times}3$ **普通卷积**实现注意图），再拼接融合；  
  - 经验表明：**注意中的卷积用普通卷积优于 CDC**（空间语义需更大感受野与平滑性）。

---

## 5. 实验与结果

### 5.1 数据与指标

- **数据集**：OULU-NPU、SiW（高分辨率，体内协议）；CASIA-MFSD、Replay-Attack、MSU-MFSD（低分辨率，跨库）；SiW-M（13 种未知攻击，跨类型）。  
- **指标**：APCER/BPCER/ACER（体内）、HTER（跨库）、AUC/EER（跨类型）。

### 5.2 主要性能

- **OULU-NPU（4 协议，体内）**：  
  - **CDCN++** 在四个协议上均**排名第一**；其中 **Prot-1: ACER=0.2%**；Prot-2: 1.3%；Prot-3: 1.8%；Prot-4: 5.0%。  
- **SiW（3 协议，体内）**：  
  - CDCN/++ 在三协议上**均优于**已有方法；如 Prot-2 **ACER≈0.04–0.06%** 量级。  
- **跨类型（CASIA/Replay/MSU，AUC）**：  
  - CDCN/++ 综合 AUC ~**96.5%**，优于多基线；在 SiW-M 上平均 **ACER≈12.7% / EER≈11.9%**。  
- **跨库（CASIA→Replay，HTER）**：  
  - **HTER=6.5%（CDCN++）**，显著优于以往帧级方法；Replay→CASIA 方向亦有提升。

### 5.3 消融与分析要点

- **$\theta$ 的作用**：当 $\theta>0.3$ 即优于普通卷积；$\theta=0.7$ 最佳。  
- **CDC vs. 其他卷积**：CDC 明显降低 ACER（＞2% 的优势）。  
- **NAS 配置**：**Varied Cells + Node Attention** 均能提升，二者叠加最佳。  
- **MAFM 设计**：注意层用**普通卷积**更佳；低/中/高层核**7/5/3** 效果最佳。  
- **鲁棒性**：在强光照/域偏移下，CDCN 的开发集与测试集曲线更一致（不过拟合），t-SNE 也显示类间分离度提升。

---

## 6. 训练/搜索设置（复现关键信息）

- **深度生成**：PRNet 估真脸 3D 形状→$32{\times}32$ 深度；真脸 $[0,1]$，攻击置 $0$。  
- **优化**：Adam，初始 lr $1\text{e}{-4}$、wd $5\text{e}{-5}$；共 1300 epoch，lr 每 500 epoch 减半；batch 56（8×1080Ti）。  
- **测试打分**：**深度图均值**作为活体分数。  
- **NAS**：PC-DARTS 风格，60 epoch，batch 12；权重与结构参数不同 lr/wd；搜索于 OULU-NPU Prot-1，后**可迁移**到其他协议/数据。

---

## 7. 直观理解与实践建议

- **为什么有效**：CDC 通过$\,x(p_0\!+\!p_n)-x(p_0)\,$显式编码**中心相对变化**，把打印/屏幕等**微纹理异常**放大出来；同时保留强度项，兼顾语义与细节。  
- **何时用 CDC、何时用普通卷积**：  
  - **表征主干**（特征提取）宜用 CDC；  
  - **注意/全局语义**（MAFM 的注意卷积）宜用普通卷积与较大核。  
- **单帧部署**：与视频多帧方法相比，**延迟/成本更低**，更适合**移动/边端**活体检测。

---

## 8. 关键公式速记

- 普通卷积：$\;y(p_0)=\sum w(p_n)x(p_0+p_n)$  
- 中央差分项：$\;\sum w(p_n)\big[x(p_0+p_n)-x(p_0)\big]$  
- **CDC（融合）**：  
  
  $$
  y(p_0)=\theta\sum w(p_n)\big[x(p_0+p_n)-x(p_0)\big]+(1-\theta)\sum w(p_n)x(p_0+p_n)
  $$
- **等价实现**：  
  
  $$
  y(p_0)=\underbrace{\sum w(p_n)x(p_0+p_n)}_{\text{普通卷积}}+\;\theta\!\cdot\!\Big(-x(p_0)\sum w(p_n)\Big)
  $$

---

## 9. 局限与展望

- 仍属早期探索：可进一步研究**层/通道自适应 $\theta$**、**域泛化**理论、以及在**图像质量评估/取证**等任务的可迁移性。  
- 融合**时序信号**（如 rPPG/运动）或跨模态（深度/红外）可望再提升跨域性能。

---

**一句话总结**：CDC 以**零参数开销**把“**中心差分的细节敏感性**”注入卷积网络，在**单帧、深度监督**框架下实现了对多种展示攻击与域偏移的**强鲁棒活体检测**。
